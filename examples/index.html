<html>
    <head>
        <script src="https://github.com/RobotWebTools/roslibjs/blob/develop/build/roslib.min.js"></script>
        <script src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
        <script src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
        <script src="RosSensorLib.min.js"></script>
        <script>

            var ros = new ROSLIB.Ros();

            ros.on('connection', function() {document.getElementById("connection_info").innerHTML = "Connected to webserver."});

            ros.on('error', function(error) { document.getElementById("connection_info").innerHTML = "Failed to connect to webserver."; });

            ros.on('close', function() { document.getElementById("connection_info").innerHTML = 'Connection to websocket server closed.'; });

            var topic = new ROSLIB.Topic({
                ros : ros,
                name : '/magneticDeclination',
                messageType: 'std_msgs/Int32'
            });

            ros.connect('ws://localhost:9090');
        </script>
    </head>
    <body>
        <h1 id='connection_info'></h1>
		<p id='test'></p>
		<div id="log"></div>
        <script>
				(function () {
    var old = console.log;
    var logger = document.getElementById('log');
    console.log = function (message) {
        if (typeof message == 'object') {
            logger.innerHTML += (JSON && JSON.stringify ? JSON.stringify(message) : message) + '<br />';
        } else {
            logger.innerHTML += message + '<br />';
        }
    }
})();
            var md = new SENSORLIB.MagneticDeclinationPublisher(ros, '/magneticDeclination');
            md.start();
			var imu = new SENSORLIB.IMUPublisher(ros, '/gyro');
			imu.start();
			
			console.log('boi')
			window.addEventListener('deviceorientation', (event) => {
			  if (event.isTrusted) {
				document.getElementById('test').innerHTML = `IS WORKING LOOK: ${event.alpha}`
			  }
			});
        </script>
    </body>
</html>